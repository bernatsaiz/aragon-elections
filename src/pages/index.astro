---
import BaseLayout from "../layouts/BaseLayout.astro";
import { podcastMeta, episodes } from "../data/podcast";
---

<BaseLayout title={podcastMeta.title}>
  <div class="hero">
    <div class="hero__gradient"></div>
    <div class="hero__content">
      <img src={`${import.meta.env.BASE_URL}cover.webp`} alt="" class="hero__art" width="192" height="192" />
      <div class="hero__text">
        <p class="hero__label">Podcast</p>
        <h1 class="hero__title">{podcastMeta.title}</h1>
        <p class="hero__subtitle">{podcastMeta.subtitle}</p>
        <p class="hero__meta">{episodes.length} episodios</p>
      </div>
    </div>
  </div>
  <section class="section" id="episodios">
    <div class="section-header">
      <h2 class="section-title">Episodios</h2>
      <p class="section-desc">{podcastMeta.description}</p>
    </div>
    <ul class="episode-list">
      {episodes.map((ep, i) => (
        <li class="episode-item" data-index={i} role="button" tabindex={0} aria-label={`Reproducir: ${ep.title}`}>
          <span class="episode-item__play">
            <span class="episode-item__num">{i + 1}</span>
            <svg class="episode-item__icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M8 5v14l11-7z" />
            </svg>
          </span>
          <div class="episode-item__art" style={`background: url(${ep.coverSrc}) var(--bg-card) center/cover no-repeat`}></div>
          <div class="episode-item__info">
            <span class="episode-item__title">{ep.title}</span>
            <span class="episode-item__desc">{ep.description}</span>
          </div>
          <span class="episode-item__duration">{ep.duration}</span>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>

<script>
  document.querySelectorAll(".episode-item").forEach((row) => {
    row.addEventListener("click", () => {
      const index = parseInt(row.getAttribute("data-index") ?? "0", 10);
      if (typeof window.__playEpisode === "function") window.__playEpisode(index);
    });
    row.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        row.click();
      }
    });
  });
</script>

<style>
  .hero { position: relative; padding: 32px 32px 48px; min-height: 280px; }
  .hero__gradient { position: absolute; inset: 0; background: linear-gradient(180deg, transparent 0%, var(--bg-base) 100%); pointer-events: none; }
  .hero__content { position: relative; display: flex; align-items: flex-end; gap: 24px; }
  .hero__art { width: 192px; height: 192px; min-width: 192px; border-radius: 8px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); object-fit: cover; display: block; }
  .hero__text { padding-bottom: 8px; }
  .hero__label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-primary); margin: 0 0 8px; }
  .hero__title { font-size: 2.5rem; font-weight: 700; letter-spacing: -0.02em; margin: 0 0 8px; line-height: 1.2; }
  .hero__subtitle { font-size: 1rem; color: var(--text-secondary); margin: 0 0 8px; }
  .hero__meta { font-size: 0.875rem; color: var(--text-muted); margin: 0; }
  .section { padding: 0 32px 32px; }
  .section-header { margin-bottom: 24px; }
  .section-title { font-size: 1.5rem; font-weight: 700; margin: 0 0 8px; }
  .section-desc { font-size: 0.9375rem; color: var(--text-secondary); margin: 0; max-width: 560px; }
  .episode-list { display: flex; flex-direction: column; gap: 2px; background: transparent; }
  .episode-item { display: grid; grid-template-columns: 48px 56px 1fr auto; align-items: center; gap: 16px; padding: 8px 0; border-radius: var(--radius); cursor: pointer; transition: background 0.15s; }
  .episode-item:hover { background: var(--bg-hover); }
  .episode-item:focus { outline: none; }
  .episode-item:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
  .episode-item__play { display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; position: relative; }
  .episode-item__num { font-size: 0.875rem; color: var(--text-muted); }
  .episode-item__icon { position: absolute; opacity: 0; transform: scale(0.8); transition: opacity 0.15s, transform 0.15s; }
  .episode-item:hover .episode-item__num { opacity: 0; }
  .episode-item:hover .episode-item__icon { opacity: 1; transform: scale(1); }
  .episode-item__play:hover .episode-item__icon { opacity: 1; transform: scale(1.1); }
  .episode-item__art { width: 56px; height: 56px; border-radius: 4px; flex-shrink: 0; }
  .episode-item__info { min-width: 0; display: flex; flex-direction: column; gap: 2px; }
  .episode-item__title { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .episode-item__desc { font-size: 0.8125rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .episode-item__duration { font-size: 0.8125rem; color: var(--text-muted); min-width: 3em; text-align: right; }
  @media (max-width: 768px) {
    .hero__content { flex-direction: column; align-items: flex-start; }
    .episode-item { grid-template-columns: 40px 1fr auto; }
    .episode-item__art { display: none; }
    .episode-item__desc { display: none; }
  }
</style>
